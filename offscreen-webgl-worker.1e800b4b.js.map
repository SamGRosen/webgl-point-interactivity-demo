{"version":3,"sources":["scripts/drawer.js","scripts/utilities.js","scripts/webgl.js","scripts/webgl-drawer.js","scripts/offscreen-webgl-worker.js"],"names":["Drawer","data","canvas","width","height","receiveState","minX","maxX","minY","maxY","currentXRange","currentYRange","needsAnimation","lastFrame","cancelAnimationFrame","scale","domain","range","domainLength","rangeLength","slope","intercept","x","loadShader","gl","type","source","shader","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","console","error","getShaderInfoLog","deleteShader","initShaderProgram","vertexSource","fragmentSource","vertexShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","shaderProgram","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","componentToHex","c","hex","toString","length","rgbToHex","r","g","b","parseInt","Number","squaresFragmentShader","colorPointsVertexShader","colorPointsFragmentShader","WebGLCanvasDrawer","getContext","sampleColors","Map","split","map","letter","Math","random","xTSNEScale","yTSNEScale","positions","colors","windowWidth","windowHeight","displayAsIfThisWide","displayAsIfThisHigh","scaleXWindowSpace","scaleYWindowSpace","toReturnX","toReturnY","forEach","line","parts","parseFloat","y","push","get","requestAnimationFrame","animate","bind","tick","enable","BLEND","blendFunc","SRC_COLOR","DST_COLOR","clearColor","clear","COLOR_BUFFER_BIT","viewport","getWebGLViewport","drawArrays","POINTS","vertexCount","programInfo","program","attribLocations","vertexPosition","getAttribLocation","vertexColor","positionBuffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","Float32Array","STATIC_DRAW","colorBuffer","vertexAttribPointer","FLOAT","enableVertexAttribArray","useProgram","OffscreenWebGLDrawer","postMessage","WebGLDrawer","self","onmessage","message","drawer","render","populateBuffers","responseData","clearBuffers"],"mappings":"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","file":"offscreen-webgl-worker.1e800b4b.js","sourceRoot":"../src","sourcesContent":["class Drawer {\n  constructor(data) {\n    this.canvas = data.canvas;\n    this.width = data.canvas.width;\n    this.height = data.canvas.height;\n    this.receiveState(data);\n  }\n\n  receiveState(data) {\n    this.minX = data.minX;\n    this.maxX = data.maxX;\n    this.minY = data.minY;\n    this.maxY = data.maxY;\n    this.currentXRange = [...data.currentXRange];\n    this.currentYRange = [...data.currentYRange];\n\n    this.needsAnimation = true;\n  }\n\n  tick() {}\n\n  animate() {}\n\n  render() {\n    if (this.lastFrame) {\n      // Avoid overlapping animation requests\n      cancelAnimationFrame(this.lastFrame);\n    }\n  }\n}\n\nexport default Drawer;\n","function scale(domain, range) {\n  const domainLength = domain[1] - domain[0];\n  const rangeLength = range[1] - range[0];\n  const slope = rangeLength / domainLength;\n  const intercept = range[1] - slope * domain[1];\n  return (x) => slope * x + intercept;\n}\n\nfunction loadShader(gl, type, source) {\n  const shader = gl.createShader(type);\n\n  gl.shaderSource(shader, source);\n\n  gl.compileShader(shader);\n\n  if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n    console.error(`Could not compile shader: ${gl.getShaderInfoLog(shader)}`);\n    gl.deleteShader(shader);\n    return null;\n  }\n  return shader;\n}\n\nfunction initShaderProgram(gl, vertexSource, fragmentSource) {\n  const vertexShader = loadShader(gl, gl.VERTEX_SHADER, vertexSource);\n  const fragmentShader = loadShader(gl, gl.FRAGMENT_SHADER, fragmentSource);\n\n  const shaderProgram = gl.createProgram();\n  gl.attachShader(shaderProgram, vertexShader);\n  gl.attachShader(shaderProgram, fragmentShader);\n  gl.linkProgram(shaderProgram);\n\n  if (!gl.getProgramParameter(shaderProgram, gl.LINK_STATUS)) {\n    console.error(\n      `Unable to initialize the shader program: ${gl.getProgramInfoLog(\n        shaderProgram\n      )}`\n    );\n    return null;\n  }\n\n  return shaderProgram;\n}\n\nfunction componentToHex(c) {\n  var hex = c.toString(16);\n  return hex.length == 1 ? \"0\" + hex : hex;\n}\n\nfunction rgbToHex(r, g, b) {\n  return parseInt(\n    Number(\"0x\" + componentToHex(r) + componentToHex(g) + componentToHex(b)),\n    10\n  );\n}\n\nexport { scale, initShaderProgram, loadShader, rgbToHex };\n","const vertexShader = `\n  attribute vec4 aVertexPosition;\n\n  void main() {\n      gl_Position = aVertexPosition;\n  }\n`;\n\nconst squaresFragmentShader = `\n  precision mediump float;\n  uniform float uGridSize;\n  uniform vec4 viewport;\n  void main() {\n    vec4 ndcPos;\n    // Reverse calculations from window space to clip space (normalized device coordinates)\n    ndcPos.xy = ((2.0 * gl_FragCoord.xy) - (2.0 * viewport.xy)) / (viewport.zw) - 1.0;\n    ndcPos.xy = ndcPos.xy - mod(ndcPos.xy, 1.0 / uGridSize);\n    gl_FragColor = vec4(ndcPos.x/2.0 + 0.5 , 0, ndcPos.y/2.0 + 0.5, 1.0);\n  }\n`;\n\nconst colorPointsVertexShader = `\n  attribute vec4 aVertexPosition;\n  attribute vec4 aVertexColor;\n\n  varying lowp vec4 vColor;\n\n  void main(void) {\n    gl_Position = aVertexPosition;\n    vColor = aVertexColor;\n    gl_PointSize = 1.0;\n  }\n`;\n\nconst colorPointsFragmentShader = `\n  varying lowp vec4 vColor;\n\n  void main(void) {\n    gl_FragColor = vColor;\n  }\n`;\n\nexport {\n  vertexShader,\n  squaresFragmentShader,\n  colorPointsVertexShader,\n  colorPointsFragmentShader,\n};\n","import Drawer from \"./drawer\";\nimport { scale, initShaderProgram } from \"./utilities\";\nimport {\n  vertexShader,\n  squaresFragmentShader,\n  colorPointsVertexShader,\n  colorPointsFragmentShader,\n} from \"./webgl.js\";\n\n// Largely taken from\n// https://github.com/mdn/webgl-examples/blob/gh-pages/tutorial/sample2/webgl-demo.js\n\nclass WebGLCanvasDrawer extends Drawer {\n  constructor(data) {\n    super(data);\n\n    this.gl = this.canvas.getContext(\"webgl\");\n\n    if (!this.gl) {\n      console.error(\"Unable to initialize WebGL!\");\n      return;\n    }\n\n    // Specific to t-SNE Dataset\n    this.sampleColors = new Map( // Create colors for sample type\n      \"ABCDEFGHIJKLMNOPQRSTUVWXYZ012\"\n        .split(\"\")\n        .map((letter) => [\n          letter,\n          [Math.random(), Math.random(), Math.random(), 0.01],\n        ])\n    );\n\n    this.xTSNEScale = scale([-10, 10], [-1, 1]);\n    this.yTSNEScale = scale([-10, 10], [-1, 1]);\n\n    this.positions = [];\n    this.colors = [];\n  }\n\n  getWebGLViewport() {\n    // Calculate appropriate webgl viewport given current selection window\n    const windowWidth = this.currentXRange[1] - this.currentXRange[0];\n    const windowHeight = this.currentYRange[1] - this.currentYRange[0];\n\n    const displayAsIfThisWide =\n      ((this.maxX - this.minX) / windowWidth) * this.width;\n    const displayAsIfThisHigh =\n      ((this.maxY - this.minY) / windowHeight) * this.height;\n\n    const scaleXWindowSpace = scale(\n      [this.minX, this.maxX],\n      [0, -displayAsIfThisWide]\n    );\n    const scaleYWindowSpace = scale(\n      [this.minY, this.maxY],\n      [0, -displayAsIfThisHigh]\n    );\n\n    const toReturnX = scaleXWindowSpace(this.currentXRange[0]);\n    const toReturnY = scaleYWindowSpace(this.currentYRange[0]);\n\n    return [toReturnX, toReturnY, displayAsIfThisWide, displayAsIfThisHigh];\n  }\n\n  populateBuffers(data) {\n    // Given raw data, populate the buffers\n    // Specific to t-SNE data\n\n    data.split(\"\\n\").forEach((line) => {\n      const parts = line.split(\",\");\n      const x = parseFloat(parts[1]);\n      const y = parseFloat(parts[2]);\n      if (!parts[0] || !x || !y) {\n        return; // skip bad rows\n      }\n\n      this.positions.push(this.xTSNEScale(x), this.yTSNEScale(y));\n      this.colors.push(...this.sampleColors.get(parts[0]));\n    });\n  }\n\n  clearBuffers() {\n    this.positions = [];\n    this.colors = [];\n  }\n\n  animate() {\n    if (!this.needsAnimation) {\n      this.lastFrame = requestAnimationFrame(this.animate.bind(this));\n      this.tick();\n      return;\n    }\n\n    this.gl.enable(this.gl.BLEND);\n    this.gl.blendFunc(this.gl.SRC_COLOR, this.gl.DST_COLOR);\n\n    // Clear the canvas before we start drawing on it.\n    this.gl.clearColor(0.0, 0.0, 0.0, 1.0);\n\n    this.gl.clear(this.gl.COLOR_BUFFER_BIT);\n\n    const viewport = this.getWebGLViewport();\n\n    this.gl.viewport(viewport[0], viewport[1], viewport[2], viewport[3]);\n\n    this.gl.drawArrays(\n      this.gl.POINTS,\n      0, // stride\n      this.vertexCount // vertex count\n    );\n\n    this.needsAnimation = false;\n    this.lastFrame = requestAnimationFrame(this.animate.bind(this));\n    this.tick();\n  }\n\n  render() {\n    super.render();\n\n    this.shaderProgram = initShaderProgram(\n      this.gl,\n      colorPointsVertexShader,\n      colorPointsFragmentShader\n    );\n\n    this.programInfo = {\n      program: this.shaderProgram,\n      attribLocations: {\n        vertexPosition: this.gl.getAttribLocation(\n          this.shaderProgram,\n          \"aVertexPosition\"\n        ),\n        vertexColor: this.gl.getAttribLocation(\n          this.shaderProgram,\n          \"aVertexColor\"\n        ),\n      },\n    };\n\n    // this.positions and this.colors populated by populateBuffers method used in Handler\n    this.vertexCount = this.positions.length / 2;\n    this.positionBuffer = this.gl.createBuffer();\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.positionBuffer);\n    this.gl.bufferData(\n      this.gl.ARRAY_BUFFER,\n      new Float32Array(this.positions),\n      this.gl.STATIC_DRAW\n    );\n\n    this.colorBuffer = this.gl.createBuffer();\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.colorBuffer);\n    this.gl.bufferData(\n      this.gl.ARRAY_BUFFER,\n      new Float32Array(this.colors),\n      this.gl.STATIC_DRAW\n    );\n\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.positionBuffer);\n    this.gl.vertexAttribPointer(\n      this.programInfo.attribLocations.vertexPosition,\n      2, // numComponents\n      this.gl.FLOAT, // type\n      false, // normalize\n      0, // stride\n      0 // offset\n    );\n    this.gl.enableVertexAttribArray(\n      this.programInfo.attribLocations.vertexPosition\n    );\n\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.colorBuffer);\n    this.gl.vertexAttribPointer(\n      this.programInfo.attribLocations.vertexColor,\n      4, // numComponents\n      this.gl.FLOAT, // type\n      false, // normalize\n      0, // stride\n      0 // offset\n    );\n    this.gl.enableVertexAttribArray(\n      this.programInfo.attribLocations.vertexColor\n    );\n\n    this.gl.useProgram(this.programInfo.program);\n\n    if (this.lastFrame) {\n      cancelAnimationFrame(this.lastFrame);\n    }\n    this.needsAnimation = true;\n    this.animate();\n  }\n}\n\nexport default WebGLCanvasDrawer;\n","import WebGLDrawer from \"./webgl-drawer\";\n\nclass OffscreenWebGLDrawer extends WebGLDrawer {\n  tick() {\n    postMessage({ type: \"tick\" });\n  }\n}\n\nself.onmessage = (message) => {\n  switch (message.data.type) {\n    case \"init\":\n      self.drawer = new OffscreenWebGLDrawer(message.data);\n      break;\n    case \"state\":\n      self.drawer.receiveState(message.data);\n      break;\n    case \"render\":\n      self.drawer.receiveState(message.data);\n      self.drawer.render();\n      break;\n    case \"buffer\":\n      self.drawer.populateBuffers(message.data.responseData);\n      break;\n    case \"clearBuffers\":\n      self.drawer.clearBuffers();\n      break;\n    default:\n      console.error(`Received unknown message type: ${message.type}`);\n  }\n};\n"]}